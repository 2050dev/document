# PASSID的生成与导入

## 功能说明

PASSID的生成全部在网站进行，其中分为4种情况（截至2022年）：

1. 当一个人的身份证号码（如果是外国人则是护照号码）在2019年第一次生成了一张2050PASS订单时，也同时生成过一个PASSID（数字19开头）
1. 当一个人的身份证号码（如果是外国人则是护照号码）在2021年第一次生成了一张2050PASS订单时，也同时生成过一个PASSID（数字21开头）
1. 当一个人用一个手机号第一次登录进入2050网站的时候，如果不绑定一个已有的PASSID，则可以创建一个新的PASSID。
1. 当一个人的身份证号码（如果是外国人则是护照号码）在2022年第一次生成了一张2050PASS订单后，如果在一个指定时间之前（比如2022年4月20日0点整），该订单一直无人在网站上将其用于PASSID的激活，则将在该指定的时间生成一个新的PASSID。

**注意！！！**

**所有在2019年以及2021年通过激活PASS生成的这些PASSID，需要在开放用户注册之前，全部导入到2050网站生成网站用户！！！**

导入顺序：先导入所有2019年订单，再导入所有2021年订单。

虽然2050大会从2018年就开始举办，但由于2018年还没有PASSID，所以2018年的订单无需导入2050网站生成网站用户。

## 导入2019年订单里面的PASSID

每一个订单需要导入的数据：

- 身份证号码（加密保存）
- PASSID（导入）
- 中文姓名
- 英文姓名
- 订单关联手机号 mobile_from_order
- 订单关联邮箱 email_from_order
- 同时标记该PASSID在2019年被激活过
- 同时生成默认登录密码

用户生成后，其登录方式（PASSID+登录密码+登录URL）自动发送到订单关联手机号+邮箱（需要考虑减少骚扰的实现）。

## 导入2021年订单里面的PASSID

对于每一个订单，先检查身份证号码是否已经存在。

case 1 如果身份证不存在：新增一条数据

- 身份证号码（加密保存）
- PASSID（导入）
- 姓名
- 订单关联手机号
- 订单关联邮箱
- 同时标记该PASSID在2019年被激活过
- 同时生成默认登录密码

用户生成后，其登录方式（PASSID+登录密码+登录URL）自动发送到订单关联手机号+邮箱（需要考虑减少骚扰的实现）。

case 2 如果身份证已存在：变更一条数据

- PASSID无论是否相同都不做变更
- 订单关联手机号如果不同则新增到数组，如果相同则不变更
- 订单关联邮箱如果不同则新增到数组，如果相同则不变更
- 同时标记该PASSID在2021年被激活过

## 用户使用手机号+验证码第一次登录2050网站后生成新的PASSID

见后续“[用户注册与登录](userlogin)”章节。

## 使用2022年订单生成新的PASSID

对于每一个订单，先检查身份证号码是否已经存在。

case 1 如果身份证不存在：新增一条数据

- 身份证号码（加密保存）
- PASSID（生成一个新的）
- 姓名
- 订单关联手机号
- 订单关联邮箱
- 同时标记该PASSID在2022年被激活过
- 同时生成默认登录密码

用户生成后，其登录方式（PASSID+登录密码+登录URL）自动发送到订单关联手机号+邮箱（需要考虑减少骚扰的实现）。

case 2 如果身份证已存在：变更一条数据

- 订单关联手机号如果不同则新增到数组，如果相同则不变更
- 订单关联邮箱如果不同则新增到数组，如果相同则不变更
- 同时标记该PASSID在2022年被激活过

## 使用2018年订单更新用户数据（不重要，选做）

这个操作可以在2019、2021年订单都导入完毕之后做一遍，然后在2022年大会结束之后再做一遍。如此一来，2018年就来过2050大会、之后今年又来过的自愿者们就能够在网站上看到自己从2018年开始就在2050留下了痕迹，小小地欢乐一下。

对于每一个订单，先检查身份证号码是否已经存在。

case 1 如果身份证不存在：啥也不用做

case 2 如果身份证已存在：变更一条数据

- 订单关联手机号如果不同则新增到数组，如果相同则不变更
- 订单关联邮箱如果不同则新增到数组，如果相同则不变更
- 同时标记该PASSID在2018年被激活过
